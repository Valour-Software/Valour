@inherits AttachmentComponent

@if (Attachment.OpenGraph != null)
{
    <a href="@Attachment.Location" target="_blank" rel="noopener noreferrer" class="site-preview">
        @if (!string.IsNullOrEmpty(Attachment.OpenGraph.Image))
        {
            <div class="site-preview-image">
                <img src="@Attachment.OpenGraph.Image" alt="@Attachment.OpenGraph.Title" loading="lazy" />
            </div>
        }
        <div class="site-preview-content">
            @if (!string.IsNullOrEmpty(Attachment.OpenGraph.SiteName))
            {
                <span class="site-preview-site">@Attachment.OpenGraph.SiteName</span>
            }
            @if (!string.IsNullOrEmpty(Attachment.OpenGraph.Title))
            {
                <span class="site-preview-title">@Attachment.OpenGraph.Title</span>
            }
            @if (!string.IsNullOrEmpty(Attachment.OpenGraph.Description))
            {
                <span class="site-preview-description">@TruncateDescription(Attachment.OpenGraph.Description)</span>
            }
        </div>
    </a>
}
else
{
    <a href="@Attachment.Location" target="_blank" rel="noopener noreferrer" class="site-preview site-preview-minimal">
        <i class="bi bi-link-45deg"></i>
        <span>@GetHostName()</span>
    </a>
}

<style>
    .site-preview {
        display: flex;
        flex-direction: column;
        max-width: 400px;
        background: var(--v-bg-secondary);
        border-radius: 8px;
        overflow: hidden;
        text-decoration: none;
        color: inherit;
        border: 1px solid var(--v-bg-tertiary);
        transition: border-color 0.2s ease;
    }

    .site-preview:hover {
        border-color: var(--v-purple);
    }

    .site-preview-image {
        width: 100%;
        max-height: 200px;
        overflow: hidden;
    }

    .site-preview-image img {
        width: 100%;
        height: auto;
        object-fit: cover;
    }

    .site-preview-content {
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .site-preview-site {
        font-size: 0.75em;
        color: var(--v-gray);
        text-transform: uppercase;
    }

    .site-preview-title {
        font-size: 0.95em;
        font-weight: 600;
        color: var(--v-text);
        line-height: 1.3;
    }

    .site-preview-description {
        font-size: 0.85em;
        color: var(--v-gray-light);
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .site-preview-minimal {
        flex-direction: row;
        align-items: center;
        padding: 10px 14px;
        gap: 8px;
    }

    .site-preview-minimal i {
        font-size: 1.2em;
        color: var(--v-gray);
    }

    .site-preview-minimal span {
        color: var(--v-gray-light);
        font-size: 0.9em;
    }
</style>

@code {
    private string TruncateDescription(string description)
    {
        if (string.IsNullOrEmpty(description))
            return description;

        const int maxLength = 150;
        if (description.Length <= maxLength)
            return description;

        return description.Substring(0, maxLength).TrimEnd() + "...";
    }

    private string GetHostName()
    {
        try
        {
            var uri = new Uri(Attachment.Location);
            return uri.Host;
        }
        catch
        {
            return Attachment.Location;
        }
    }
}
